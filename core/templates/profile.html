{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile - Multi Step</title>
  <style>
    /* --- your CSS unchanged --- */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #e0dacbff, #c5abb6ff);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container { width: 100%; max-width: 600px; }

    h1 {
      text-align: center;
      margin-bottom: 25px;
      font-size: 28px;
      font-weight: 700;
      color: #3b2f2f;
    }

    .glass {
      background: rgba(255,255,255,0.5);
      backdrop-filter: blur(12px);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .profile-pic-section { text-align: center; margin-bottom: 20px; }
    .profile-pic-section img {
      width: 120px; height: 120px; border-radius: 50%;
      object-fit: cover; border: 3px solid #7d5a50;
    }
    .profile-pic-section input[type="file"] { display: none; }
    .profile-pic-section label {
      display: inline-block; margin-top: 10px;
      padding: 8px 15px; background: #7d5a50; color: #fff;
      font-weight: 600; border-radius: 8px; cursor: pointer;
      transition: 0.3s;
    }
    .profile-pic-section label:hover { background: #4fbc9aff; }

    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; font-weight: 600; margin-bottom: 5px; color: #3b2f2f; }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%; padding: 10px 12px; border-radius: 10px; border: none;
      outline: none; background: rgba(255,255,255,0.8); font-size: 15px; transition: 0.3s;
    }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      background: #fff; box-shadow: 0 0 8px #89dff5ff;
    }

    .options-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .options-group label {
      background: rgba(125,90,80,0.7); color: #fff; padding: 8px 12px;
      border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;
      transition: 0.3s;
    }
    .options-group input { display: none; }
    .options-group input:checked + label { background: #b08968; }

    .next-btn, .submit-btn {
      display: block; width: 100%; padding: 14px; border: none;
      border-radius: 10px; font-size: 16px; font-weight: 600;
      background: #31725dff; color: #fff; cursor: pointer; transition: 0.3s; margin-top: 20px;
    }
    .next-btn:hover, .submit-btn:hover { background: #b08968; }

    .step { display: none; }
    .step.active { display: block; }

    h2.step-heading { font-size: 22px; margin-bottom: 20px; color: #3b2f2f; text-align: center; }

    .invalid { border: 2px solid red; }

    .custom-add { display: flex; gap: 5px; margin-top: 8px; }
    .custom-add input { flex: 1; padding: 6px; border-radius: 8px; border: none; }
    .custom-add button { padding: 6px 12px; border-radius: 8px; border: none; background: #31725dff; color: #fff; cursor: pointer; }
    .custom-add button:hover { background: #b08968; }
  </style>
</head>
<body>
  <div class="container glass">
    <h1>üßëüèº‚Äçüíª User Profile üë©üèº‚Äçüíª</h1>

    <!-- üîπ Added form -->
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}

      <!-- Step 1: Basic Info -->
      <div class="step active" id="step1">
        <div class="profile-pic-section">
          {% if form.photo.value %}
            <img id="userPhoto" src="{{ form.photo.value.url }}" alt="User">
          {% else %}
            <img id="userPhoto" src="https://via.placeholder.com/120" alt="User">
          {% endif %}
          <input type="file" id="photoInput" name="photo" accept="image/*">
          <label for="photoInput">Choose Profile Picture</label>
        </div>

        <div class="form-group">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" name="first_name" placeholder="Enter first name" value="{{ form.first_name.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" name="last_name" placeholder="Enter last name" value="{{ form.last_name.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="email" placeholder="Enter your email" value="{{ form.email.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label for="dob">Date of Birth</label>
          <input type="date" id="dob" name="dob" value="{{ form.dob.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label for="gender">Gender</label>
          <select id="gender" name="gender">
            <option value="" disabled {% if not form.gender.value %}selected{% endif %}>Select gender</option>
            <option value="female" {% if form.gender.value|default_if_none:'' == "female" %}selected{% endif %}>Female</option>
            <option value="male" {% if form.gender.value|default_if_none:'' == "male" %}selected{% endif %}>Male</option>
            <option value="other" {% if form.gender.value|default_if_none:'' == "other" %}selected{% endif %}>Other</option>
          </select>
        </div>
        <button class="next-btn" type="button" onclick="nextStep(2)">Next ‚û°</button>
      </div>

      <!-- Step 2: Ethnicity & Location -->
      <div class="step" id="step2">
        <h2 class="step-heading">Your Ethnicity & Location</h2>
        <div class="form-group">
          <label for="nationality">Nationality</label>
          <input type="text" id="nationality" name="nationality" placeholder="Enter nationality" value="{{ form.nationality.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label for="country">Country</label>
          <select id="country" name="country">
            <option value="" disabled {% if not form.country.value %}selected{% endif %}>Select country</option>
            <option value="India" {% if form.country.value|default_if_none:'' == "India" %}selected{% endif %}>India</option>
            <option value="USA" {% if form.country.value|default_if_none:'' == "USA" %}selected{% endif %}>USA</option>
            <option value="UK" {% if form.country.value|default_if_none:'' == "UK" %}selected{% endif %}>UK</option>
            <option value="Canada" {% if form.country.value|default_if_none:'' == "Canada" %}selected{% endif %}>Canada</option>
            <option value="Australia" {% if form.country.value|default_if_none:'' == "Australia" %}selected{% endif %}>Australia</option>
          </select>
        </div>
        <div class="form-group">
          <label for="location">Your Location</label>
          <input type="text" id="location" name="location" placeholder="City / Town" value="{{ form.location.value|default_if_none:'' }}">
        </div>
        <button class="next-btn" type="button" onclick="nextStep(3)">Next ‚û°</button>
      </div>

      <!-- Step 3: About Yourself -->
      <div class="step" id="step3">
        <h2 class="step-heading">About Yourself</h2>
        <div class="form-group">
          <label>Interests & Hobbies</label>
          <div class="options-group" id="hobbiesGroup">
            {% for hobby in hobbies_list %}
              <input type="checkbox" id="hobby_{{ forloop.counter }}" name="hobbies" value="{{ hobby }}" {% if hobby in form_hobbies %}checked{% endif %}>
              <label for="hobby_{{ forloop.counter }}">{{ hobby }}</label>
            {% endfor %}
          </div>
          <div class="custom-add">
            <input type="text" id="customHobby" placeholder="Add custom hobby">
            <button type="button" onclick="addHobby()">Add</button>
          </div>
        </div>
        <div class="form-group">
          <label>Employment Status</label>
          <select id="employment" name="employment">
            <option value="Full-time" {% if form.employment.value|default_if_none:'' == "Full-time" %}selected{% endif %}>Working Full Time</option>
            <option value="Part-time" {% if form.employment.value|default_if_none:'' == "Part-time" %}selected{% endif %}>Working Part Time</option>
            <option value="Unemployed" {% if form.employment.value|default_if_none:'' == "Unemployed" %}selected{% endif %}>Unemployed</option>
            <option value="Student" {% if form.employment.value|default_if_none:'' == "Student" %}selected{% endif %}>Student</option>
            <option value="Traveller" {% if form.employment.value|default_if_none:'' == "Traveller" %}selected{% endif %}>Traveller</option>
            <option value="Freelancer" {% if form.employment.value|default_if_none:'' == "Freelancer" %}selected{% endif %}>Freelancer</option>
          </select>
        </div>
        <div class="form-group">
          <label>Are you an Early Bird or Night Owl?</label>
          <select id="daynight" name="daynight">
            <option value="" disabled {% if not form.daynight.value %}selected{% endif %}>Select</option>
            <option value="Early Bird" {% if form.daynight.value|default_if_none:'' == "Early Bird" %}selected{% endif %}>üåÖ Early Bird</option>
            <option value="Night Owl" {% if form.daynight.value|default_if_none:'' == "Night Owl" %}selected{% endif %}>üåô Night Owl</option>
          </select>
        </div>
        <button class="next-btn" type="button" onclick="nextStep(4)">Next ‚û°</button>
      </div>

      <!-- Step 4: Roommate Preferences -->
      <div class="step" id="step4">
        <h2 class="step-heading">Roommate Preferences</h2>
        <div class="form-group">
          <label>Preferred Gender</label>
          <select id="prefGender" name="pref_gender">
            <option value="" disabled {% if not form.pref_gender.value %}selected{% endif %}>Select</option>
            <option value="Male" {% if form.pref_gender.value|default_if_none:'' == "Male" %}selected{% endif %}>Male</option>
            <option value="Female" {% if form.pref_gender.value|default_if_none:'' == "Female" %}selected{% endif %}>Female</option>
            <option value="Anyone" {% if form.pref_gender.value|default_if_none:'' == "Anyone" %}selected{% endif %}>Anyone</option>
          </select>
        </div>
        <div class="form-group">
          <label>Roommate Habits / Interests</label>
          <div class="options-group" id="habitsGroup">
            {% for habit in habits_list %}
              <input type="checkbox" id="habit_{{ forloop.counter }}" name="room_rules" value="{{ habit }}" {% if habit in form_habits %}checked{% endif %}>
              <label for="habit_{{ forloop.counter }}">{{ habit }}</label>
            {% endfor %}
          </div>
          <div class="custom-add">
            <input type="text" id="customHabit" placeholder="Add custom habit">
            <button type="button" onclick="addHabit()">Add</button>
          </div>
        </div>
        <div class="form-group">
          <label for="budget">Budget Limit ($ per month)</label>
          <input type="number" id="budget" name="budget" placeholder="Enter your budget" min="0" value="{{ form.budget.value|default_if_none:'' }}">
        </div>
        <div class="form-group">
          <label>Preferred Person Schedule</label>
          <select id="prefSchedule" name="pref_schedule">
            <option value="Early Bird" {% if form.pref_schedule.value|default_if_none:'' == "Early Bird" %}selected{% endif %}>Early Bird</option>
            <option value="Night Owl" {% if form.pref_schedule.value|default_if_none:'' == "Night Owl" %}selected{% endif %}>Night Owl</option>
            <option value="Flexible" {% if form.pref_schedule.value|default_if_none:'' == "Flexible" %}selected{% endif %}>Flexible</option>
          </select>
        </div>
        <button class="submit-btn" type="submit">Submit ‚úÖ</button>
      </div>

    </form> <!-- üîπ Closing form -->

  </div>

  <script>
    const steps = [1,2,3,4];
    function nextStep(step) {
      if(!validateStep(step-1)) return;
      steps.forEach(s => document.getElementById('step'+s).classList.remove('active'));
      document.getElementById('step'+step).classList.add('active');
    }
    function validateStep(step) {
      let valid = true;
      let fields = [];
      if(step===1){ fields = ["firstName","lastName","email","dob","gender"]; }
      else if(step===2){ fields = ["nationality","country","location"]; }
      else if(step===3){
        const hobbies = document.querySelectorAll('#step3 input[type="checkbox"]:checked');
        if(hobbies.length===0){ alert("Select at least one hobby."); return false;}
        fields = ["employment","daynight"];
      } else if(step===4){ fields = ["prefGender","prefSchedule"]; }
      fields.forEach(id=>{
        const el = document.getElementById(id);
        if(!el.value){ el.classList.add("invalid"); valid = false; } else el.classList.remove("invalid");
      });
      if(!valid) alert("Please fill all required fields.");
      return valid;
    }
    // Profile picture preview
    const photoInput = document.getElementById('photoInput');
    const userPhoto = document.getElementById('userPhoto');
    photoInput.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = e => { userPhoto.src = e.target.result; }
        reader.readAsDataURL(file);
      }
    });
    function addHobby() {
      const input = document.getElementById("customHobby"); const val = input.value.trim();
      if(val){
        const id = "hobby_" + Date.now();
        const container = document.getElementById("hobbiesGroup");
        const checkbox = document.createElement("input"); checkbox.type="checkbox"; checkbox.id=id; checkbox.value=val; checkbox.checked=true;
        const label = document.createElement("label"); label.htmlFor=id; label.textContent=val;
        container.appendChild(checkbox); container.appendChild(label); input.value="";
      }
    }
    function addHabit() {
      const input = document.getElementById("customHabit"); const val = input.value.trim();
      if(val){
        const id = "habit_" + Date.now();
        const container = document.getElementById("habitsGroup");
        const checkbox = document.createElement("input"); checkbox.type="checkbox"; checkbox.id=id; checkbox.value=val; checkbox.checked=true;
        const label = document.createElement("label"); label.htmlFor=id; label.textContent=val;
        container.appendChild(checkbox); container.appendChild(label); input.value="";
      }
    }
  </script>
</body>
</html>
